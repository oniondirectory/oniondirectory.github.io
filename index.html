t<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnionDir</title>
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-cyan: #00ffff;
            --neon-blue: #0066ff;
            --dark-bg: #050505;
            --card-bg: #0f0f1a;
            --text-main: #e0e0e0;
        }

        body {
            background-color: var(--dark-bg);
            background-image: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            color: var(--text-main);
            font-family: 'Courier New', monospace;
            display: flex; justify-content: center; min-height: 100vh; margin: 0; padding: 20px;
        }

        .container {
            width: 100%; max-width: 800px; background: var(--card-bg);
            padding: 30px; border: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue); border-radius: 5px;
            display: flex; flex-direction: column;
        }

        .header-box { text-align: center; border-bottom: 1px solid var(--neon-pink); margin-bottom: 30px; padding-bottom: 10px; }
        h2 { color: var(--neon-cyan); text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 10px var(--neon-cyan); margin: 0; }
        #global-counter { color: var(--neon-pink); font-size: 0.9rem; font-weight: bold; margin-top: 5px; }

        /* Recherche */
        .search-container { margin-bottom: 25px; }
        .search-input {
            width: calc(100% - 30px); background: rgba(0, 255, 255, 0.05);
            border: 1px solid var(--neon-cyan); padding: 15px;
            color: var(--neon-cyan); font-family: 'Courier New', monospace; outline: none;
        }

        /* Formulaire */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 30px; }
        input { background: #000; border: 1px solid var(--neon-blue); padding: 12px; color: var(--neon-cyan); outline: none; font-family: 'Courier New'; }
        .full { grid-column: span 2; }
        #add-btn { grid-column: span 2; background: transparent; color: var(--neon-pink); border: 2px solid var(--neon-pink); padding: 12px; cursor: pointer; font-weight: bold; text-transform: uppercase; }
        #add-btn:hover { background: var(--neon-pink); color: #000; box-shadow: 0 0 15px var(--neon-pink); }

        /* Navigation */
        .nav-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; height: 35px; }
        .back-btn { background: transparent; color: var(--neon-cyan); border: 1px solid var(--neon-cyan); padding: 5px 15px; cursor: pointer; text-transform: uppercase; font-family: 'Courier New'; }

        /* Affichage dynamique */
        .grid-categories { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .cat-card {
            background: rgba(0, 102, 255, 0.1); border: 1px solid var(--neon-blue);
            padding: 20px; text-align: center; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; font-weight: bold; color: var(--neon-cyan);
            display: flex; flex-direction: column;
        }
        .cat-card:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 20px var(--neon-blue); }
        .cat-count { font-size: 0.7rem; color: var(--neon-pink); margin-top: 5px; }

        .link-item {
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(0, 255, 255, 0.2);
            padding: 15px; display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; cursor: pointer;
        }
        .link-item:hover { border-color: var(--neon-cyan); background: rgba(0, 255, 255, 0.05); }
        .cat-tag { font-size: 0.6rem; color: var(--neon-pink); border: 1px solid var(--neon-pink); padding: 2px 5px; display: inline-block; margin-bottom: 5px; }
        .delete-btn { background: transparent; color: #ff3333; border: 1px solid #ff3333; cursor: pointer; padding: 5px; font-size: 0.7rem; }

        /* BAS DE PAGE (IMPORT/EXPORT) */
        .tools-box {
            margin-top: auto; padding-top: 30px; display: flex; gap: 10px;
            border-top: 1px dotted #333; justify-content: center;
        }
        .tool-btn {
            background: #000; border: 1px solid #555; color: #888;
            padding: 8px 12px; cursor: pointer; font-size: 0.7rem; text-transform: uppercase; font-family: 'Courier New';
        }
        .tool-btn:hover { border-color: var(--neon-cyan); color: var(--neon-cyan); }

        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--neon-cyan); color: #000; padding: 10px 20px; display: none; box-shadow: 0 0 15px var(--neon-cyan); font-weight: bold; z-index: 999; }
    </style>
</head>
<body>
<div class="container">
    <div class="header-box">
        <h2>>OnionDirectory</h2>
        <div id="global-counter">[TOTAL : 0]</div>
    </div>

    <div class="search-container">
        <input type="text" id="main-search" class="search-input" placeholder="RECHERCHER UN NOM...">
    </div>
    
    <div class="form-grid">
        <input type="text" id="linkName" placeholder="NOM DU SITE">
        <input type="text" id="linkCat" placeholder="CATÉGORIE">
        <input type="text" id="linkUrl" class="full" placeholder="ADRESSE (URL)">
        <button id="add-btn">AJOUTER LE LIEN</button>
    </div>

    <div class="nav-top">
        <button id="back-btn" class="back-btn" style="display:none" onclick="exitFolder()">< RETOUR</button>
        <span id="current-view-title" style="color: var(--neon-pink)">> DOSSIER PRINCIPAL</span>
    </div>

    <div id="main-display"></div>

    <div class="tools-box">
        <button class="tool-btn" onclick="exportData()">EXPORT</button>
        <button class="tool-btn" onclick="document.getElementById('importFile').click()">IMPORT</button>
        <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">
    </div>
</div>

<div id="toast">COPIÉ !</div>

<script>
    let db;
    let currentFolder = null;

    const request = indexedDB.open("CyberFinalDB", 1);
    request.onupgradeneeded = (e) => {
        db = e.target.result;
        db.createObjectStore("links", { keyPath: "id", autoIncrement: true });
    };
    request.onsuccess = (e) => {
        db = e.target.result;
        render();
    };

    document.getElementById('main-search').oninput = (e) => {
        render(e.target.value.toLowerCase());
    };

    function exitFolder() {
        currentFolder = null;
        document.getElementById('main-search').value = '';
        render();
    }

    document.getElementById('add-btn').onclick = () => {
        const name = document.getElementById('linkName').value;
        const category = document.getElementById('linkCat').value.trim().toUpperCase() || "DIVERS";
        const url = document.getElementById('linkUrl').value;
        if(!name || !url) return;
        const tx = db.transaction("links", "readwrite");
        tx.objectStore("links").add({ name, category, url });
        tx.oncomplete = () => {
            document.querySelectorAll('input:not(#main-search)').forEach(i => i.value = '');
            render();
        };
    };

    function render(filter = "") {
        const display = document.getElementById('main-display');
        const searchInput = document.getElementById('main-search');
        const backBtn = document.getElementById('back-btn');
        const title = document.getElementById('current-view-title');
        const globalCountEl = document.getElementById('global-counter');

        const tx = db.transaction("links", "readonly");
        tx.objectStore("links").getAll().onsuccess = (e) => {
            const allLinks = e.target.result;
            globalCountEl.innerText = `[TOTAL : ${allLinks.length}]`;

            if (currentFolder === null) {
                backBtn.style.display = 'none';
                searchInput.placeholder = "RECHERCHER DANS TOUT...";
                if (filter === "") {
                    title.innerText = "> DOSSIER PRINCIPAL";
                    const catStats = allLinks.reduce((acc, link) => {
                        acc[link.category] = (acc[link.category] || 0) + 1;
                        return acc;
                    }, {});
                    display.innerHTML = '<div class="grid-categories"></div>';
                    const grid = display.querySelector('.grid-categories');
                    Object.keys(catStats).forEach(cat => {
                        const btn = document.createElement('div');
                        btn.className = 'cat-card';
                        btn.innerHTML = `<span>${cat}</span><span class="cat-count">[LIENS : ${catStats[cat]}]</span>`;
                        btn.onclick = () => { currentFolder = cat; render(); };
                        grid.appendChild(btn);
                    });
                    if(Object.keys(catStats).length === 0) display.innerHTML = "<p style='text-align:center; color:#444'>AUCUN LIEN ENREGISTRÉ</p>";
                } else {
                    const filtered = allLinks.filter(l => l.name.toLowerCase().includes(filter));
                    title.innerText = `> RÉSULTATS : ${filtered.length}`;
                    displayLinks(filtered, true);
                }
            } else {
                backBtn.style.display = 'block';
                searchInput.placeholder = `RECHERCHER DANS ${currentFolder}...`;
                const folderLinks = allLinks.filter(l => l.category === currentFolder);
                const filteredLinks = folderLinks.filter(l => l.name.toLowerCase().includes(filter));
                title.innerText = filter === "" ? `> DOSSIER : ${currentFolder} [${folderLinks.length}]` : `> TROUVÉ : ${filteredLinks.length}`;
                displayLinks(filteredLinks, false);
            }
        };
    }

    function displayLinks(links, showTags) {
        const display = document.getElementById('main-display');
        display.innerHTML = "";
        links.forEach(link => {
            const div = document.createElement('div');
            div.className = 'link-item';
            div.onclick = () => copyToClipboard(link.url);
            div.innerHTML = `
                <div>
                    ${showTags ? `<span class="cat-tag">${link.category}</span>` : ''}
                    <div style="color:var(--neon-cyan); font-weight:bold">${link.name}</div>
                    <div style="font-size:0.7rem; color:#555">${link.url}</div>
                </div>
                <button class="delete-btn" onclick="event.stopPropagation(); deleteLink(${link.id})">SUPPR.</button>
            `;
            display.appendChild(div);
        });
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
        const t = document.getElementById('toast');
        t.innerText = "LIEN COPIÉ !";
        t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 1000);
    }

    function deleteLink(id) {
        if(!confirm("Supprimer ce lien ?")) return;
        const tx = db.transaction("links", "readwrite");
        tx.objectStore("links").delete(id);
        tx.oncomplete = () => render(document.getElementById('main-search').value.toLowerCase());
    }

    function exportData() {
        const tx = db.transaction("links", "readonly");
        tx.objectStore("links").getAll().onsuccess = (e) => {
            const data = JSON.stringify(e.target.result, null, 2);
            const blob = new Blob([data], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "sauvegarde_liens.json";
            a.click();
            URL.revokeObjectURL(url);
        };
    }

    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const importedLinks = JSON.parse(e.target.result);
                const tx = db.transaction("links", "readwrite");
                const store = tx.objectStore("links");
                importedLinks.forEach(link => {
                    delete link.id; 
                    store.add(link);
                });
                tx.oncomplete = () => {
                    alert("IMPORTATION RÉUSSIE !");
                    render();
                };
            } catch (err) {
                alert("ERREUR : FICHIER INVALIDE");
            }
        };
        reader.readAsText(file);
    }
</script>

</body>

</html>

